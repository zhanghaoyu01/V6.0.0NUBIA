"use strict";$(function(){$(window).unload(function(){var c=cookie.get("shop");c=JSON.parse(c),$("tbody tr").each(function(t,n){var a=$(n).attr("class").split("-")[1].toString(),e=$(n).find(".num.cart-cnt").val();c.forEach(function(t,n){t.id==a&&(t.num=e)})}),alert("确定要离开么？")});var i=cookie.get("shop");if(i){var t=(i=JSON.parse(i)).map(function(t){return t.id}).join();$.ajax({type:"get",url:"../lib/shop.php",data:{idList:t},dataType:"json",success:function(t){console.log(t);var c="";t.forEach(function(a,t){var n=i.filter(function(t,n){return t.id===a.id}),e=a.imgurl.slice(1,-1);e=JSON.parse(e),c='\n                            <tr class="p-'+a.id+'">\n                                <td><img src="'+e[0]+'" style="width:100px;"></td>\n                                <td class="productname">\n                                    <a target="_blank" productid="1104" href="/product/s/1104" class="pdt-title">'+a.title+"</a>\n                                </td>\n                                <td>¥"+a.price+'</td>\n                                <td>\n                                    <div class="btn-cnts"><span class="table-cut">-</span> <input type="text" maxlength="2" readonly="readonly" class="num cart-cnt" value="'+n[0].num+'"> <span class="table-add">+</span></div>\n                                </td>\n                                <td class="sum" style="line-height: 1.8;">￥'+(n[0].num*a.price).toFixed(2)+'</td>\n                                <td><a title="删除" class="cart-close close">×</a></td>\n                            </tr>\n                            ',$(".cart-con tbody").append(c),s()}),$(".btn-cnts").on("click",".table-cut",function(){var t=$(this).siblings(".num").val()||1;1==t?t=1:t--,$(this).siblings(".num").val(t),s(),$("tbody .sum").html();var n=$(this).parent().parent().parent(),a=n.find(".num.cart-cnt").val()*n.find("td").eq(2).text().slice(1);n.find(".sum").html("¥"+a)}),$(".btn-cnts").on("click",".table-add",function(){var t=$(this).siblings(".num").val()||1;t++,$(this).siblings(".num").val(t),s();var n=$(this).parent().parent().parent(),a=n.find(".num.cart-cnt").val()*n.find("td").eq(2).text().slice(1);console.log("'么么哒 ': paren.find('td').eq(3).text()",n.find("td").eq(2).text()),console.log("'么么哒 ': paren.find('td').eq(3).text().slice(1)",n.find("td").eq(2).text().slice(1)),n.find(".sum").html("¥"+a)}),$("tbody").on("dblclick","tr",function(){$(this).data("flag")?$(this).css({backgroundColor:"#fff"}).data("flag",!1):$(this).css({backgroundColor:"#EBF3E6"}).data("flag",!0)});var n=0;function s(){var a=0,e=0;$("tbody tr").each(function(t,n){$(n).data("flag")&&(a+=parseInt($(n).find("td").eq(4).html().slice(1)),e+=parseInt($(n).find(".btn-cnts .num").val()))}),$(".sum p").html("￥"+a.toFixed(2)),$(".cart-h1 span").html(e)}$("#selectall").on("click",function(){$(this).prop("checked")?(n=$("tbody tr").length,$("tbody tr").css({backgroundColor:"#EBF3E6"}).data("flag",!0)):(n=0,$("tbody tr").css({backgroundColor:"#fff"}).data("flag",!1)),s()}),$("tbody").on("dblclick","tr",function(){$(this).data("flag")?n++:n--,$("tbody tr").length==n?$("#selectall").prop("checked",!0):$("#selectall").prop("checked",!1),s()}),$("tbody").on("click",".cart-close.close",function(){alert("是否要删除该商品？");var n=$(this).parent().parent().attr("class").split("-")[1].toString();n=Number(n);var t=JSON.parse(cookie.get("shop"));t=t.filter(function(t){return t.id!=n}),cookie.set("shop",JSON.stringify(t)),$(this).parent().parent().remove(),location.reload()}),s()}})}});